# 12306 火车票购票系统 - 详细学习路线指南

## 📚 目录

- [项目介绍](#项目介绍)
- [技术架构](#技术架构)
- [项目结构](#项目结构)
- [学习路线](#学习路线)
  - [第一阶段：基础准备](#第一阶段基础准备)
  - [第二阶段：项目架构理解](#第二阶段项目架构理解)
  - [第三阶段：核心框架学习](#第三阶段核心框架学习)
  - [第四阶段：业务服务深入](#第四阶段业务服务深入)
  - [第五阶段：高级特性](#第五阶段高级特性)
  - [第六阶段：实战与优化](#第六阶段实战与优化)
- [学习建议](#学习建议)
- [常见问题](#常见问题)

---

## 项目介绍

### 什么是 12306 项目？

12306 铁路购票服务是一个模拟中国铁路12306购票系统的完整分布式项目，包含会员、购票、订单、支付和网关等核心服务。这个项目旨在帮助学习者快速掌握分布式系统设计的技巧，特别适合对高并发、分布式感兴趣的同学学习。

### 项目特点

1. **真实业务场景**：模拟真实的12306购票流程，包括车票查询、选座、下单、支付等完整链路
2. **高并发设计**：涵盖缓存、消息队列、分库分表等高并发场景的解决方案
3. **微服务架构**：采用 Spring Cloud 微服务架构，服务间解耦，便于学习
4. **最新技术栈**：使用 JDK17 + SpringBoot3 + SpringCloud 最新技术体系
5. **完整的前后端**：包含 Vue3 前端控制台，可以完整体验业务流程

### 项目版本

项目提供两种版本：

- **SpringBoot 聚合服务版本**：适合测试和部署，可以直接启动 `aggregation-service` 聚合服务和网关服务
- **SpringCloud 微服务版本**：适合学习微服务设计，可以分别启动支付、订单、用户、购票和网关服务

---

## 技术架构

### 核心技术栈

#### 后端技术
- **Java 17**：使用最新的 LTS 版本
- **Spring Boot 3.0.7**：最新版本的 Spring Boot
- **Spring Cloud 2022.0.3**：微服务框架
- **Spring Cloud Alibaba 2022.0.0.0-RC2**：阿里云微服务组件
- **MyBatis Plus 3.5.3.1**：持久层框架
- **ShardingSphere 5.3.2**：分库分表中间件
- **Redis 6.0+**：缓存和分布式锁
- **RocketMQ 4.9+**：消息队列
- **Nacos 2.0+**：服务注册与配置中心
- **Sentinel 1.8+**：流量控制（可选）
- **Redisson 3.21.3**：Redis 客户端
- **Hippo4j 1.5.0**：动态线程池框架

#### 前端技术
- **Vue 3.2.13**：前端框架
- **Ant Design Vue 3.2.20**：UI 组件库
- **Vue Router 4.0.3**：路由管理
- **Axios 1.4.0**：HTTP 客户端

#### 数据库
- **MySQL 8.0+**：关系型数据库
- **分库分表**：使用 ShardingSphere 实现

### 架构图

```
┌─────────────────────────────────────────────────────────┐
│                     前端层 (Vue3)                        │
│              console-vue (控制台界面)                    │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│                   网关层 (Gateway)                       │
│              gateway-service (端口: 9000)                │
└────────────────────┬────────────────────────────────────┘
                     │
        ┌────────────┼────────────┐
        │            │            │
┌───────▼──────┐ ┌──▼──────────┐ ┌───────────────▼──────┐
│ 聚合服务版本  │ │ 微服务版本   │ │                       │
│aggregation-  │ │             │ │                       │
│service       │ │             │ │                       │
│(端口: 9005)  │ │             │ │                       │
└──────┬───────┘ └──┬──────────┘ └───────────────────────┘
       │            │
       │    ┌───────┼───────┬───────────┬──────────┐
       │    │       │       │           │          │
┌──────▼────▼───┐ ┌▼──────┐ ┌▼──────┐ ┌▼──────┐ ┌▼──────┐
│ user-service  │ │ticket-│ │order- │ │pay-   │ │       │
│  用户服务     │ │service│ │service│ │service│ │       │
│              │ │购票服务│ │订单服务│ │支付服务│ │       │
└──────┬───────┘ └───┬────┘ └───┬────┘ └───┬────┘ └───────┘
       │            │           │          │
       └────────────┼───────────┼──────────┘
                    │           │
        ┌───────────┼───────────┼───────────┐
        │           │           │           │
┌───────▼───┐ ┌─────▼────┐ ┌───▼────┐ ┌────▼────┐
│  MySQL    │ │  Redis   │ │RocketMQ│ │  Nacos  │
│ 数据库    │ │  缓存    │ │消息队列 │ │注册中心 │
└───────────┘ └──────────┘ └────────┘ └─────────┘
```

---

## 项目结构

### 目录结构说明

```
12306/
├── dependencies/              # 依赖管理模块
│   └── pom.xml              # 统一管理所有依赖版本
│
├── frameworks/              # 框架层（核心组件）
│   ├── base/                # 基础框架（通用基础类）
│   ├── bizs/                # 业务框架（用户业务组件）
│   ├── cache/               # 缓存框架（Redis封装）
│   ├── common/              # 通用工具类
│   ├── convention/          # 约定配置
│   ├── database/            # 数据库框架（MyBatis封装）
│   ├── designpattern/       # 设计模式框架（责任链等）
│   ├── distributedid/       # 分布式ID生成器
│   ├── idempotent/          # 幂等性框架
│   ├── log/                 # 日志框架
│   └── web/                 # Web框架（统一响应、异常处理）
│
├── services/                # 服务层（业务服务）
│   ├── aggregation-service/ # 聚合服务（聚合所有业务）
│   ├── gateway-service/    # 网关服务（路由、限流）
│   ├── user-service/        # 用户服务（注册、登录、乘车人）
│   ├── ticket-service/      # 购票服务（车次查询、选座、购票）
│   ├── order-service/       # 订单服务（订单创建、查询）
│   └── pay-service/         # 支付服务（支付、退款）
│
├── console-vue/             # 前端项目（Vue3）
│   ├── src/
│   │   ├── views/           # 页面视图
│   │   ├── components/      # 组件
│   │   ├── router/          # 路由配置
│   │   └── service/         # API服务
│   └── package.json
│
├── resources/               # 资源文件
│   ├── db/                  # 数据库脚本
│   └── data/                # 测试数据
│
├── scripts/                 # 脚本文件
│   ├── start-gateway.ps1    # 启动网关脚本
│   └── start-aggregation.ps1 # 启动聚合服务脚本
│
└── pom.xml                  # 父POM文件
```

### 核心模块说明

#### 1. Frameworks（框架层）

这是项目的核心基础层，提供了各种可复用的组件：

- **base**：提供基础配置、工具类
- **cache**：Redis缓存封装，包含布隆过滤器、缓存穿透解决方案
- **distributedid**：分布式ID生成器（雪花算法等）
- **idempotent**：幂等性保证框架
- **designpattern**：设计模式实现（责任链模式等）
- **database**：数据库操作封装
- **web**：统一响应格式、全局异常处理

#### 2. Services（服务层）

业务服务实现：

- **user-service**：用户注册、登录、乘车人管理
- **ticket-service**：车次查询、座位选择、购票
- **order-service**：订单创建、查询、取消
- **pay-service**：支付、退款
- **gateway-service**：API网关，路由转发
- **aggregation-service**：聚合服务，整合所有业务

---

## 学习路线

### 第一阶段：基础准备（1-2周）

#### 学习目标
- 了解项目整体结构
- 搭建开发环境
- 成功启动项目
- 理解基本的业务流程

#### 学习内容

**1.1 环境准备**
- [ ] 安装 JDK 17
- [ ] 安装 Maven 3.6+
- [ ] 安装 MySQL 8.0+
- [ ] 安装 Redis 6.0+
- [ ] 安装 Nacos 2.0+
- [ ] 安装 RocketMQ 4.9+
- [ ] 安装 Node.js（前端开发需要）

**1.2 项目启动**
- [ ] 克隆/下载项目
- [ ] 导入数据库脚本（`resources/db/12306-springboot.sql`）
- [ ] 配置 Nacos（服务注册中心）
- [ ] 配置 Redis（缓存）
- [ ] 配置 RocketMQ（消息队列）
- [ ] 启动聚合服务（`aggregation-service`）
- [ ] 启动网关服务（`gateway-service`）
- [ ] 启动前端项目（`console-vue`）

**1.3 熟悉业务流程**
- [ ] 用户注册流程
- [ ] 用户登录流程
- [ ] 车票查询流程
- [ ] 购票流程
- [ ] 订单查询流程
- [ ] 支付流程

**实践任务**
1. 使用 Postman 或前端界面测试所有基础接口
2. 画出完整的业务流程图
3. 理解每个接口的输入输出

**推荐阅读**
- 项目 README.md
- DEPLOYMENT_GUIDE.md（部署指南）

---

### 第二阶段：项目架构理解（2-3周）

#### 学习目标
- 理解微服务架构设计
- 理解项目的分层结构
- 理解服务间的调用关系
- 理解网关的作用

#### 学习内容

**2.1 微服务架构**
- [ ] 理解为什么使用微服务架构
- [ ] 理解服务拆分原则
- [ ] 理解服务注册与发现（Nacos）
- [ ] 理解服务间通信（Feign、RocketMQ）

**2.2 项目分层结构**
- [ ] 理解 Frameworks 层的作用
- [ ] 理解 Services 层的业务逻辑
- [ ] 理解依赖关系（dependencies → frameworks → services）

**2.3 网关服务（gateway-service）**
- [ ] 理解 API 网关的作用
- [ ] 学习路由配置
- [ ] 学习跨域处理
- [ ] 学习请求转发逻辑

**2.4 聚合服务（aggregation-service）**
- [ ] 理解聚合服务的定位
- [ ] 理解与微服务版本的区别
- [ ] 学习如何聚合多个业务服务

**实践任务**
1. 画出服务调用关系图
2. 理解网关如何路由到各个服务
3. 对比聚合服务版本和微服务版本的差异

**推荐阅读**
- `services/gateway-service/` 目录下的代码
- `services/aggregation-service/` 目录下的代码
- Spring Cloud Gateway 官方文档

---

### 第三阶段：核心框架学习（3-4周）

#### 学习目标
- 深入理解框架层的设计
- 掌握分布式系统的基础组件
- 理解设计模式的应用

#### 学习内容

**3.1 分布式ID生成器（distributedid）**
- [ ] 理解为什么需要分布式ID
- [ ] 学习雪花算法（Snowflake）
- [ ] 理解 Redis 自增ID
- [ ] 学习如何保证ID唯一性

**学习路径：**
```
frameworks/distributedid/
├── 阅读 DistributedIdGenerator 接口
├── 阅读 SnowflakeIdGenerator 实现
├── 阅读 RedisIdGenerator 实现
└── 理解在业务中的使用场景
```

**3.2 缓存框架（cache）**
- [ ] 理解 Redis 缓存的使用
- [ ] 学习缓存穿透解决方案
- [ ] 学习布隆过滤器（Bloom Filter）
- [ ] 理解缓存更新策略

**学习路径：**
```
frameworks/cache/
├── 阅读 CacheLoader 接口
├── 阅读 RedisCache 实现
├── 阅读 BloomFilter 实现
└── 理解缓存穿透防护机制
```

**3.3 幂等性框架（idempotent）**
- [ ] 理解什么是幂等性
- [ ] 学习幂等性保证方案
- [ ] 学习 Token 机制
- [ ] 学习 Redis + Lua 脚本实现

**学习路径：**
```
frameworks/idempotent/
├── 阅读 IdempotentExecuteHandler 接口
├── 阅读各种实现类（SpEL、Token等）
├── 阅读 Lua 脚本实现
└── 理解在支付、下单等场景的应用
```

**3.4 设计模式框架（designpattern）**
- [ ] 学习责任链模式（Chain of Responsibility）
- [ ] 理解抽象责任链模式
- [ ] 学习在购票流程中的应用

**学习路径：**
```
frameworks/designpattern/
├── 阅读 AbstractChainContext
├── 阅读责任链节点的实现
└── 理解在 ticket-service 中的应用
```

**3.5 Web框架（web）**
- [ ] 学习统一响应格式
- [ ] 学习全局异常处理
- [ ] 学习参数校验

**学习路径：**
```
frameworks/web/
├── 阅读 Result 统一响应类
├── 阅读 GlobalExceptionHandler
└── 理解异常处理机制
```

**实践任务**
1. 实现一个简单的分布式ID生成器
2. 实现一个简单的缓存工具类
3. 实现一个简单的幂等性检查
4. 画出各个框架的类图

**推荐阅读**
- 分布式ID生成算法原理
- Redis 缓存最佳实践
- 幂等性设计原则
- 设计模式相关书籍

---

### 第四阶段：业务服务深入（4-6周）

#### 学习目标
- 深入理解各个业务服务的实现
- 理解业务逻辑的复杂性
- 理解高并发场景的处理

#### 学习内容

**4.1 用户服务（user-service）**

**核心功能：**
- 用户注册
- 用户登录（用户名/手机号/邮箱）
- 乘车人管理
- 用户信息修改

**技术亮点：**
- 分库分表（ShardingSphere）
- 缓存穿透防护（布隆过滤器）
- 敏感信息加密
- 读请求扩散问题解决

**学习路径：**
```
services/user-service/
├── 阅读 UserRegisterService（用户注册）
│   ├── 理解注册流程
│   ├── 理解缓存穿透防护
│   └── 理解分库分表路由
├── 阅读 UserLoginService（用户登录）
│   ├── 理解多种登录方式
│   ├── 理解读请求扩散问题
│   └── 理解JWT Token生成
└── 阅读 PassengerService（乘车人管理）
    ├── 理解乘车人CRUD
    └── 理解分库分表
```

**4.2 购票服务（ticket-service）**

**核心功能：**
- 车次查询
- 座位查询
- 选座购票
- 余票查询

**技术亮点：**
- 复杂的座位分配算法
- Redis Lua 脚本保证原子性
- 令牌桶限流
- 高并发下的票务处理

**学习路径：**
```
services/ticket-service/
├── 阅读 TicketService（车票服务）
│   ├── 理解车次查询逻辑
│   ├── 理解座位分配算法
│   └── 理解余票扣减逻辑
├── 阅读 SeatService（座位服务）
│   ├── 理解座位查询
│   └── 理解选座逻辑
└── 阅读 Lua 脚本
    ├── ticket_availability_token_bucket.lua
    └── ticket_availability_rollback_token_bucket.lua
```

**重点理解：**
1. **座位分配算法**：优先分配相邻座位，其次同车厢不相邻，最后不同车厢
2. **余票扣减**：购买北京南到南京南的票，需要扣减多个区间的票
3. **并发控制**：使用 Redis Lua 脚本保证原子性

**4.3 订单服务（order-service）**

**核心功能：**
- 订单创建
- 订单查询
- 订单取消
- 订单状态流转

**技术亮点：**
- 分库分表
- 订单状态机
- 消息队列异步处理
- 幂等性保证

**学习路径：**
```
services/order-service/
├── 阅读 OrderService（订单服务）
│   ├── 理解订单创建流程
│   ├── 理解订单状态流转
│   └── 理解订单取消逻辑
└── 阅读 OrderItemService（订单项服务）
    └── 理解订单明细管理
```

**4.4 支付服务（pay-service）**

**核心功能：**
- 支付创建
- 支付回调
- 支付查询
- 退款处理

**技术亮点：**
- 支付宝集成
- 支付回调处理
- 支付状态同步
- 消息队列异步通知

**学习路径：**
```
services/pay-service/
├── 阅读 PayService（支付服务）
│   ├── 理解支付创建流程
│   ├── 理解支付回调处理
│   └── 理解退款逻辑
└── 阅读支付宝集成代码
```

**实践任务**
1. 画出用户注册的完整流程图（包括缓存、数据库操作）
2. 画出购票的完整流程图（包括座位分配算法）
3. 画出订单创建的完整流程图（包括消息队列）
4. 画出支付的完整流程图（包括回调处理）
5. 实现一个简单的座位分配算法
6. 理解分库分表的配置和使用

**推荐阅读**
- ShardingSphere 官方文档
- RocketMQ 官方文档
- 高并发系统设计相关文章

---

### 第五阶段：高级特性（3-4周）

#### 学习目标
- 理解高并发场景的处理
- 理解分布式系统的难点
- 理解性能优化方案

#### 学习内容

**5.1 分库分表（ShardingSphere）**

**学习重点：**
- [ ] 理解为什么需要分库分表
- [ ] 学习分片键的选择
- [ ] 学习分片策略
- [ ] 理解读请求扩散问题
- [ ] 学习如何平滑上线分库分表

**实践任务：**
1. 阅读 `shardingsphere-config-dev.yaml` 配置文件
2. 理解用户表、订单表的分表规则
3. 理解如何路由到正确的分表

**5.2 缓存设计**

**学习重点：**
- [ ] 理解缓存穿透、击穿、雪崩
- [ ] 学习布隆过滤器的使用
- [ ] 学习缓存更新策略
- [ ] 理解多级缓存

**实践任务：**
1. 阅读 `frameworks/cache/` 中的缓存实现
2. 理解用户注册时的缓存穿透防护
3. 理解车次查询的缓存设计

**5.3 消息队列（RocketMQ）**

**学习重点：**
- [ ] 理解消息队列的作用
- [ ] 学习消息发送和消费
- [ ] 学习事务消息
- [ ] 理解消息的可靠性保证

**实践任务：**
1. 阅读订单服务中的消息发送代码
2. 阅读支付服务中的消息消费代码
3. 理解消息在业务流程中的作用

**5.4 高并发处理**

**学习重点：**
- [ ] 理解购票场景的高并发挑战
- [ ] 学习 Redis Lua 脚本保证原子性
- [ ] 学习令牌桶限流
- [ ] 理解分布式锁的使用

**实践任务：**
1. 阅读购票服务中的 Lua 脚本
2. 理解令牌桶限流的实现
3. 理解如何防止超卖

**5.5 动态线程池（Hippo4j）**

**学习重点：**
- [ ] 理解为什么需要动态线程池
- [ ] 学习线程池的配置
- [ ] 学习线程池的监控

**实践任务：**
1. 阅读 `aggregation-service` 中的线程池配置
2. 理解在选座场景中的使用

**推荐阅读**
- 《高性能MySQL》
- 《Redis设计与实现》
- 《分布式系统概念与设计》
- 高并发系统设计相关文章

---

### 第六阶段：实战与优化（持续）

#### 学习目标
- 能够独立实现新功能
- 能够优化现有代码
- 能够解决实际问题

#### 学习内容

**6.1 代码阅读与理解**
- [ ] 阅读所有核心代码
- [ ] 理解设计思路
- [ ] 画出完整的架构图
- [ ] 整理技术文档

**6.2 功能扩展**
- [ ] 实现新功能（如：退票、改签）
- [ ] 优化现有功能
- [ ] 修复发现的Bug

**6.3 性能优化**
- [ ] 分析性能瓶颈
- [ ] 优化数据库查询
- [ ] 优化缓存策略
- [ ] 优化接口响应时间

**6.4 测试与部署**
- [ ] 编写单元测试
- [ ] 编写集成测试
- [ ] 学习部署流程
- [ ] 学习监控和日志

**实践任务**
1. 实现一个完整的退票功能
2. 优化车次查询的性能
3. 添加更多的监控指标
4. 编写项目技术文档

**推荐阅读**
- 项目官方文档：https://nageoffer.com/12306
- 面试系列文章
- 技术博客和论坛

---

## 学习建议

### 1. 循序渐进
- 不要急于求成，按照学习路线逐步深入
- 每个阶段都要充分理解后再进入下一阶段
- 遇到问题及时查阅文档和资料

### 2. 理论与实践结合
- 不仅要阅读代码，还要动手实践
- 尝试修改代码，观察效果
- 实现一些简单的功能来加深理解

### 3. 画图辅助理解
- 画出架构图、流程图、类图
- 通过图形化方式理解复杂的逻辑
- 整理成文档便于复习

### 4. 记录学习笔记
- 记录重要的知识点
- 记录遇到的问题和解决方案
- 记录自己的思考和理解

### 5. 参与社区
- 加入项目交流群
- 与其他学习者交流
- 向作者提问

### 6. 持续学习
- 关注项目更新
- 学习相关技术的最新发展
- 阅读技术博客和书籍

---

## 常见问题

### Q1: 我应该从哪个版本开始学习？

**A:** 建议从聚合服务版本开始，因为：
- 启动简单，只需要启动两个服务
- 代码集中，便于理解整体流程
- 适合快速上手和测试

等理解了整体架构后，再学习微服务版本，理解服务拆分和通信。

### Q2: 我没有分布式系统经验，能学会吗？

**A:** 完全可以！这个项目就是为学习者设计的：
- 代码注释详细
- 有完整的文档
- 有在线体验地址可以参考
- 有社区支持

建议按照学习路线循序渐进，先理解基础，再深入高级特性。

### Q3: 学习这个项目需要多长时间？

**A:** 根据个人基础不同，建议：
- **有Java基础，无分布式经验**：2-3个月
- **有Java和Spring基础**：1-2个月
- **有微服务经验**：3-4周

关键是要充分理解每个知识点，不要急于求成。

### Q4: 如何验证我的学习效果？

**A:** 可以通过以下方式验证：
1. 能够独立启动项目并运行
2. 能够理解每个服务的功能
3. 能够画出架构图和流程图
4. 能够解释关键技术点（分库分表、缓存、消息队列等）
5. 能够实现新功能或优化现有代码

### Q5: 遇到问题怎么办？

**A:** 可以：
1. 查阅项目文档：https://nageoffer.com/12306
2. 查看项目 Issues
3. 加入项目交流群
4. 查阅相关技术文档

### Q6: 这个项目适合写到简历上吗？

**A:** 非常适合！项目提供了：
- 简历亮点和难点说明
- 面试题汇总
- 项目经验总结

可以参考项目文档中的"面试系列"部分。

---

## 学习资源

### 官方资源
- 项目地址：GitHub
- 在线文档：https://nageoffer.com/12306
- 在线体验：http://12306.magestack.cn

### 技术文档
- Spring Boot 官方文档
- Spring Cloud 官方文档
- ShardingSphere 官方文档
- RocketMQ 官方文档
- Nacos 官方文档

### 推荐书籍
- 《Spring Boot实战》
- 《Spring Cloud微服务实战》
- 《高性能MySQL》
- 《Redis设计与实现》
- 《分布式系统概念与设计》

---

## 总结

12306 项目是一个非常好的分布式系统学习项目，涵盖了：
- ✅ 微服务架构设计
- ✅ 高并发处理
- ✅ 分布式系统基础组件
- ✅ 数据库分库分表
- ✅ 缓存设计
- ✅ 消息队列
- ✅ 设计模式应用

按照这个学习路线，循序渐进，你一定能够深入理解分布式系统的设计和实现。

**祝你学习顺利！🚀**

---

*最后更新：2024年*
*如有问题，欢迎反馈和改进*

